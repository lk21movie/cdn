!function(g){g.fn.theiaStickySidebar=function(i){function t(i,t){return!0===i.initialized||!(g("body").width()<i.minWidth)&&(t=t,(l=i).initialized=!0,0===g("#theia-sticky-sidebar-stylesheet-"+l.namespace).length&&g("head").append(g('<style id="theia-sticky-sidebar-stylesheet-'+l.namespace+'">.theiaStickySidebar:after {content: ""; display: table; clear: both;}</style>')),t.each(function(){function b(){i.fixedScrollTop=0,i.sidebar.css({"min-height":"1px"}),i.stickySidebar.css({position:"static",width:"",transform:"none"})}var e,i={};i.sidebar=g(this),i.options=l||{},i.container=g(i.options.containerSelector),0==i.container.length&&(i.container=i.sidebar.parent()),i.sidebar.parents().css("-webkit-transform","none"),i.sidebar.css({position:i.options.defaultPosition,overflow:"visible","-webkit-box-sizing":"border-box","-moz-box-sizing":"border-box","box-sizing":"border-box"}),i.stickySidebar=i.sidebar.find(".theiaStickySidebar"),0==i.stickySidebar.length&&(e=/(?:text|application)\/(?:x-)?(?:javascript|ecmascript)/i,i.sidebar.find("script").filter(function(i,t){return 0===t.type.length||t.type.match(e)}).remove(),i.stickySidebar=g("<div>").addClass("theiaStickySidebar").append(i.sidebar.children()),i.sidebar.append(i.stickySidebar)),i.marginBottom=parseInt(i.sidebar.css("margin-bottom")),i.paddingTop=parseInt(i.sidebar.css("padding-top")),i.paddingBottom=parseInt(i.sidebar.css("padding-bottom"));var t,o,a,s=i.stickySidebar.offset().top,n=i.stickySidebar.outerHeight();i.stickySidebar.css("padding-top",1),i.stickySidebar.css("padding-bottom",1),s-=i.stickySidebar.offset().top,n=i.stickySidebar.outerHeight()-n-s,0==s?(i.stickySidebar.css("padding-top",0),i.stickySidebarPaddingTop=0):i.stickySidebarPaddingTop=1,0==n?(i.stickySidebar.css("padding-bottom",0),i.stickySidebarPaddingBottom=0):i.stickySidebarPaddingBottom=1,i.previousScrollTop=null,i.fixedScrollTop=0,b(),i.onScroll=function(i){if(i.stickySidebar.is(":visible"))if(g("body").width()<i.options.minWidth)b();else{if(i.options.disableOnResponsiveLayouts)if(i.sidebar.outerWidth("none"==i.sidebar.css("float"))+50>i.container.width())return void b();var t,e,o,a,s,n,d=g(document).scrollTop(),r="static";d>=i.sidebar.offset().top+(i.paddingTop-i.options.additionalMarginTop)&&(e=i.paddingTop+l.additionalMarginTop,s=i.paddingBottom+i.marginBottom+l.additionalMarginBottom,o=i.sidebar.offset().top,a=i.sidebar.offset().top+(c=i.container,p=c.height(),c.children().each(function(){p=Math.max(p,g(this).height())}),p),t=0+l.additionalMarginTop,c=i.stickySidebar.outerHeight()+e+s<g(window).height()?t+i.stickySidebar.outerHeight():g(window).height()-i.marginBottom-i.paddingBottom-l.additionalMarginBottom,e=o-d+i.paddingTop,s=a-d-i.paddingBottom-i.marginBottom,o=i.stickySidebar.offset().top-d,a=i.previousScrollTop-d,"fixed"==i.stickySidebar.css("position")&&"modern"==i.options.sidebarBehavior&&(o+=a),"stick-to-top"==i.options.sidebarBehavior&&(o=l.additionalMarginTop),"stick-to-bottom"==i.options.sidebarBehavior&&(o=c-i.stickySidebar.outerHeight()),o=0<a?Math.min(o,t):Math.max(o,c-i.stickySidebar.outerHeight()),o=Math.max(o,e),o=Math.min(o,s-i.stickySidebar.outerHeight()),r=!(s=i.container.height()==i.stickySidebar.outerHeight())&&o==t||!s&&o==c-i.stickySidebar.outerHeight()?"fixed":d+o-i.sidebar.offset().top-i.paddingTop<=l.additionalMarginTop?"static":"absolute"),"fixed"==r?(n=g(document).scrollLeft(),i.stickySidebar.css({position:"fixed",width:h(i.stickySidebar)+"px",transform:"translateY("+o+"px)",left:i.sidebar.offset().left+parseInt(i.sidebar.css("padding-left"))-n+"px",top:"0px"})):"absolute"==r?(n={},"absolute"!=i.stickySidebar.css("position")&&(n.position="absolute",n.transform="translateY("+(d+o-i.sidebar.offset().top-i.stickySidebarPaddingTop-i.stickySidebarPaddingBottom)+"px)",n.top="0px"),n.width=h(i.stickySidebar)+"px",n.left="",i.stickySidebar.css(n)):"static"==r&&b(),"static"!=r&&1==i.options.updateSidebarHeight&&i.sidebar.css({"min-height":i.stickySidebar.outerHeight()+i.stickySidebar.offset().top-i.sidebar.offset().top+i.paddingBottom}),i.previousScrollTop=d}var c,p},i.onScroll(i),g(document).on("scroll."+i.options.namespace,(a=i,function(){a.onScroll(a)})),g(window).on("resize."+i.options.namespace,(o=i,function(){o.stickySidebar.css({position:"static"}),o.onScroll(o)})),"undefined"!=typeof ResizeSensor&&new ResizeSensor(i.stickySidebar[0],(t=i,function(){t.onScroll(t)}))}),!0);var l}function h(i){var t;try{t=i[0].getBoundingClientRect().width}catch(i){}return void 0===t&&(t=i.width()),t}var e,o,a,s,n,d;return(i=g.extend({containerSelector:"",additionalMarginTop:0,additionalMarginBottom:0,updateSidebarHeight:!0,minWidth:0,disableOnResponsiveLayouts:!0,sidebarBehavior:"modern",defaultPosition:"relative",namespace:"TSS"},i)).additionalMarginTop=parseInt(i.additionalMarginTop)||0,i.additionalMarginBottom=parseInt(i.additionalMarginBottom)||0,t(e=i,o=this)||(console.log("TSS: Body width smaller than options.minWidth. Init is delayed."),g(document).on("scroll."+e.namespace,(n=e,d=o,function(i){t(n,d)&&g(this).unbind(i)})),g(window).on("resize."+e.namespace,(a=e,s=o,function(i){t(a,s)&&g(this).unbind(i)}))),this}}(jQuery);
